name: Auto Create PR on Push
on:
  push:
    branches:
      - test  # 监听 test 分支的提交

jobs:
  create-pr:
    runs-on: ubuntu-latest
    permissions:
      contents: write  
      pull-requests: write
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          ref: ${{ github.sha }}  # 检出当前提交的代码

      - name: Generate Changes (示例：修改 README)
        run: |
          echo "# Updated at $(date)" >> README.md  
          git config user.name "1309959633-github-actions"  
          git config user.email "1309959633@qq.com"

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}  # 使用默认 GitHub Actions token
          branch: auto-pr-${{ github.run_id }}  # 动态生成唯一分支名，避免重复
          base: main  # 目标合并分支
          title: "Automated PR: Updates from ${{ github.sha }}"
          reviewers: "Copilot"  # 指定审查人
          body: |  # PR 描述模板
            This PR was auto-generated by GitHub Actions.
          commit-message: "chore: auto-update via GitHub Actions"

          # 2. 触发 AI 审查
      # - name: Run AI Review
      #   if: steps.create-pr.outputs.pull-request-number != ''  # PR 创建成功才执行
      #   uses: remedyproduct/gpt-review-action@v0.0.1
      #   with:
      #     github_token: ${{ secrets.GITHUB_TOKEN }}
      #     openai_token: ${{ secrets.OPENAI_TOKEN }}  # 需提前配置 OpenAI API Key
      #     openai_model: gpt-4o-mini  # 可选模型：gpt-4o, o1-mini 等
      #     extra_prompt: "重点检查安全漏洞和性能问题"  # 自定义审查提示